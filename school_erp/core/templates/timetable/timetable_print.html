<!DOCTYPE html>
<html>
<head>
    <title>Class Timetable</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
        }
        th { background: #f3f3f3; }
        @media print {
            button { display: none; }
        }
    </style>
</head>
<body>

<h2>Class Timetable</h2>
<h3 id="classInfo"></h3>

<button onclick="window.print()">Print / Save PDF</button>

<table id="timetableTable"></table>

<script>
(async () => {
    const params = new URLSearchParams(window.location.search);
    const classId = params.get("class_id");
    const sectionId = params.get("section_id");

    document.getElementById("classInfo").innerText =
    `Class ${classId} - Section ${sectionId}`;


    const auth = {
Authorization: "Bearer " + window.ACCESS_TOKEN

    };

    const [wdRes, pRes, ttRes] = await Promise.all([
        fetch("https://erp.backend.smartbus360.com/weekdays/", { headers: auth }),
        fetch("https://erp.backend.smartbus360.com/periods/", { headers: auth }),
        fetch(`https://erp.backend.smartbus360.com/timetable/?class_id=${classId}&section_id=${sectionId}`, { headers: auth })
    ]);

    const weekdays = await wdRes.json();
    const periods = await pRes.json();
    const timetable = await ttRes.json();

    const table = document.getElementById("timetableTable");

    // Header
    let html = "<tr><th>Day</th>";
    periods.forEach(p => html += `<th>${p.name}<br>${p.start_time}-${p.end_time}</th>`);
    html += "</tr>";

    // Rows
    weekdays.forEach(wd => {
        html += `<tr><td><b>${wd.name}</b></td>`;
        periods.forEach(p => {
            const slot = timetable.find(
                t => t.weekday_id === wd.id && t.period_no === p.order_no
            );
            // html += `<td>${slot ? "Assigned" : "-"}</td>`;
            html += `<td>
    ${
      slot
        ? `<b>${slot.subject_name}</b><br>
           <span style="font-size:12px">${slot.teacher_name}</span>`
        : "-"
    }
</td>`;

        });
        html += "</tr>";
    });

    table.innerHTML = html;
})();
</script>

</body>
</html>
