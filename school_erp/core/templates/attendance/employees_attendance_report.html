{% extends "base/layout.html" %}
{% load static %}

{% block content %}
<style>
.card {
  background: #ffffff;
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,.05);
}

.card-title {
  font-size: 15px;
  font-weight: 600;
  color: #111827;
}

.attendance-table {
  width: 100%;
  border-collapse: collapse;
}

.attendance-table th {
  background: #f9fafb;
  text-align: left;
  font-size: 12px;
  font-weight: 600;
  padding: 12px;
  color: #6b7280;
}

.attendance-table td {
  padding: 12px;
  border-top: 1px solid #e5e7eb;
  font-size: 14px;
}

.attendance-table tr:hover {
  background: #f9fafb;
}

.table-btn {
  padding: 6px 12px;
  font-size: 13px;
  border-radius: 6px;
  background: #f3f4f6;
  border: 1px solid #e5e7eb;
}

.table-search {
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
}

.badge {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}

.badge-success { background: #dcfce7; color: #166534; }
.badge-danger  { background: #fee2e2; color: #991b1b; }
.badge-warning { background: #fef3c7; color: #92400e; }

</style>

<div class="content-wrapper">
  <div class="page-container space-y-6">

    <!-- Breadcrumb -->
    <div class="breadcrumb-bar">
      <span class="text-muted">Attendance</span>
      <span class="mx-2">|</span>
      <span class="fw-semibold">Employees Attendance Record</span>
    </div>

    <!-- Date + Search -->
    <form method="get" class="flex justify-between items-center flex-wrap gap-3">

      <div class="flex gap-2 items-center">
        <input type="date" name="start_date" value="{{ start_date }}" class="table-search">
        <span>to</span>
        <input type="date" name="end_date" value="{{ end_date }}" class="table-search">
        <button class="table-btn">Apply</button>
      </div>

      <div class="flex items-center gap-2">
        <input
          type="text"
          name="search"
          value="{{ search }}"
          placeholder="Search employee..."
          class="table-search"
        >
      </div>

    </form>

    <!-- Summary Card -->
    <div class="card p-5">
      <div class="card-title mb-3">Monthly Attendance Summary</div>
      <canvas id="employeeAttendanceChart" height="100"></canvas>
    </div>

    <!-- Table Card -->
    <div class="card p-5">

      <div class="overflow-x-auto">
        <table class="attendance-table">
          <thead>
            <tr>
              <th>DATE</th>
              <th>DAY</th>
              <th>ID</th>
              <th>NAME</th>
              <th>TYPE</th>
              <th>STATUS</th>
              <th>TIME</th>
            </tr>
          </thead>

          <tbody>
          {% for r in records %}
            <tr>
              <td>{{ r.date|date:"d-m-Y" }}</td>
              <td>{{ r.date|date:"D" }}</td>
              <td>{{ r.employee_id }}</td>
              <td class="font-medium">{{ r.employee_name }}</td>
              <td>Teacher</td>
              <td>
                {% if r.status == "present" %}
                  <span class="badge badge-success">P</span>
                {% elif r.status == "absent" %}
                  <span class="badge badge-danger">A</span>
                {% else %}
                  <span class="badge badge-warning">L</span>
                {% endif %}
              </td>
              <td>â€”</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="text-center text-gray-400 py-6">
                No records found
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="text-sm text-gray-500 mt-3">
        Showing {{ records|length }} entries
      </div>

    </div>

  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// fetch("/api/employee-attendance-monthly?month=2025-12")
fetch("https://erp.backend.smartbus360.com/attendance-reports/employees/monthly-summary?month=2025-12", {
  headers: {
    "Authorization": "Bearer {{ request.session.auth.access_token }}"
  }
})
  .then(res => res.json())
  .then(data => {
    const ctx = document.getElementById("employeeAttendanceChart");

    new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Present", "Absent", "Leave"],
        datasets: [{
          label: "Employee Attendance (Monthly)",
          data: [data.present, data.absent, data.leave],
          backgroundColor: [
            "#22c55e",
            "#ef4444",
            "#facc15"
          ],
          borderRadius: 6
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1 }
          }
        }
      }
    });
  });
</script>

{% endblock %}
