<div id="homeworkModal"
     class="fixed inset-0 bg-black bg-opacity-40 hidden flex items-center justify-center z-50">

    <div class="bg-white rounded-xl w-full max-w-lg p-6 relative">

        <!-- Header -->
        <div class="flex justify-between items-center mb-4">
            <h2 class="font-semibold text-lg">Add Homework or Assignment</h2>
            <button onclick="closeHomeworkModal()" class="text-red-500 text-xl">
                &times;
            </button>
        </div>

        <!-- Form -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <div>
                <label class="text-xs">Homework Date*</label>
<input type="date" id="hwDate" class="table-search w-full">
            </div>

            <div>
                <label class="text-xs">Set by*</label>
<select id="hwTeacher" class="table-search w-full"></select>

            </div>

            <div>
                <label class="text-xs">Class*</label>
<select id="hwClass" class="table-search w-full"></select>

            </div>

            <div>
                <label class="text-xs">Subject*</label>
<select id="hwSubject" class="table-search w-full"></select>
            </div>

            <div class="md:col-span-2">
                <label class="text-xs">Homework Detail*</label>
<textarea id="hwDetails" class="table-search w-full h-28"></textarea>
            </div>

        </div>

        <!-- Footer -->
        <div class="flex justify-end gap-2 mt-4">
            <button onclick="closeHomeworkModal()" class="px-4 py-2 border rounded-full text-sm">
                Close
            </button>
<button onclick="submitHomework()"
        class="bg-green-500 text-white px-4 py-2 rounded-full text-sm">
    + Add Homework
</button>

        </div>

    </div>
</div>

<script>
function openHomeworkModal() {
    document.getElementById("homeworkModal").classList.remove("hidden");
}
function closeHomeworkModal() {
    document.getElementById("homeworkModal").classList.add("hidden");
}
</script>
<script>
async function submitHomework() {
    const payload = {
        class_id: document.getElementById("hwClass").value,
        subject_id: document.getElementById("hwSubject").value,
        teacher_id: Number(document.getElementById("hwTeacher").value),
        title: "Homework",
        description: document.getElementById("hwDetails").value,
        due_date: document.getElementById("hwDate").value
    };

    const res = await fetch("https://erp.backend.smartbus360.com/homework/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
Authorization: "Bearer " + window.ACCESS_TOKEN,

        },
        body: JSON.stringify(payload)
    });

    if (!res.ok) {
        alert("Failed to add homework");
        return;
    }

    alert("Homework added");
    closeHomeworkModal();
    searchHomework();
}
</script>

<script>
async function loadHomeworkFormData() {

    // Load Classes
    const clsRes = await fetch("https://erp.backend.smartbus360.com/classes/", {
        headers: { Authorization: "Bearer " + window.ACCESS_TOKEN,}
    });
    const classes = await clsRes.json();

    const classSelect = document.getElementById("hwClass");
    classSelect.innerHTML = `<option value="">Select Class</option>`;
    classes.forEach(c => {
        classSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`;
    });

    // Load Subjects
    const subRes = await fetch("https://erp.backend.smartbus360.com/subjects/", {
        headers: { Authorization: "Bearer " + window.ACCESS_TOKEN, }
    });
    const subjects = await subRes.json();

    const subjectSelect = document.getElementById("hwSubject");
    subjectSelect.innerHTML = `<option value="">Select Subject</option>`;
    subjects.forEach(s => {
        subjectSelect.innerHTML += `<option value="${s.id}">${s.name}</option>`;
    });
    // Load Teachers
const tRes = await fetch("https://erp.backend.smartbus360.com/employees/?role=Teacher", {
    headers: { Authorization: "Bearer " + window.ACCESS_TOKEN, }
});
const teachers = await tRes.json();

const teacherSelect = document.getElementById("hwTeacher");
teacherSelect.innerHTML = `<option value="">Select Teacher</option>`;
teachers.forEach(t => {
    teacherSelect.innerHTML += `<option value="${t.id}">${t.name}</option>`;
});

}

function openHomeworkModal() {
    document.getElementById("homeworkModal").classList.remove("hidden");
    loadHomeworkFormData();
}
</script>
