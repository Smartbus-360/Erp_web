{% extends "base/layout.html" %}
{% block content %}

<!-- Breadcrumb + Actions -->
<div class="flex items-center justify-between mb-6">
    <div class="text-sm text-gray-500">
        Students <span class="mx-1">/</span>
        <span class="font-medium text-gray-800">All Students</span>
    </div>

    <!-- <div class="flex gap-2">
        <button class="p-2 rounded bg-gray-200 hover:bg-gray-300">
            <i class="ri-refresh-line"></i>
        </button>
        <button class="flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded">
            <i class="ri-search-line"></i>
            Search
        </button>
    </div> -->
    <div class="flex gap-2">
    <input
        type="text"
        id="searchInput"
        placeholder="Search student name..."
        class="px-4 py-2 border rounded-lg focus:outline-none focus:ring w-64"
    />

    <button
        onclick="loadStudents()"
        class="flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded">
        <i class="ri-search-line"></i>
        Search
    </button>
</div>

</div>

<!-- Cards Grid -->

    <!-- Student Card -->
     <div id="studentsContainer"
     class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">


    <!-- Add New Card -->
    <a href="{% url 'core:add_student' %}"
       class="border-2 border-dashed border-indigo-400 rounded-xl
              flex flex-col items-center justify-center
              text-indigo-600 hover:bg-indigo-50 transition">

        <i class="ri-add-line text-4xl mb-2"></i>
        <span class="font-medium">Add New</span>
    </a>

</div>

{% block page_js %}
<script>
const params = new URLSearchParams(window.location.search);
const classId = params.get("class_id");
const section = params.get("section");

async function loadStudents() {
    const search = document.getElementById("searchInput").value;

    // let url = "https://erp.backend.smartbus360.com/students/";

    // if (search) {
    //     url += `?search=${encodeURIComponent(search)}`;
    // }
    let url = "https://erp.backend.smartbus360.com/students/";

const q = [];

if (search) q.push(`search=${encodeURIComponent(search)}`);
if (classId) q.push(`class_id=${classId}`);
if (section) q.push(`section=${encodeURIComponent(section)}`);

if (q.length) {
    url += "?" + q.join("&");
}


    const res = await fetch(url, {
        headers: {
            "Authorization": "Bearer " + window.ACCESS_TOKEN
        }
    });

    if (!res.ok) {
        alert("Failed to load students");
        return;
    }

    const students = await res.json();
    const container = document.getElementById("studentsContainer");
    container.innerHTML = "";

    if (students.length === 0) {
        container.innerHTML = `
            <div class="col-span-full text-center text-gray-500 py-10">
                No students found
            </div>
        `;
        return;
    }

    students.forEach(stu => {
        container.innerHTML += `
        <div class="bg-white border rounded-xl p-4 text-center shadow-sm">

            <div class="w-20 h-20 mx-auto mb-3 rounded-full bg-gray-200 flex items-center justify-center">
                <i class="ri-user-3-fill text-4xl text-gray-500"></i>
            </div>

            <p class="text-sm text-gray-500">${stu.admission_no}</p>
            <h3 class="font-semibold text-gray-800">${stu.name}</h3>
            <p class="text-xs text-gray-500">
                Class ${stu.class_name}${stu.section ? "-" + stu.section : ""}
            </p>

            <div class="flex justify-center gap-2 mt-4">
                <a href="/students/admission-letter/?student_id=${stu.id}"
                   class="w-9 h-9 flex items-center justify-center rounded-full bg-indigo-100 text-indigo-600">
                    <i class="ri-eye-line"></i>
                </a>

                <a href="/students/add/?id=${stu.id}"
                   class="w-9 h-9 flex items-center justify-center rounded-full bg-blue-100 text-blue-600">
                    <i class="ri-pencil-line"></i>
                </a>

                <button onclick="deleteStudent(${stu.id})"
                        class="w-9 h-9 flex items-center justify-center rounded-full bg-red-100 text-red-600">
                    <i class="ri-delete-bin-line"></i>
                </button>
            </div>
        </div>`;
    });
}

// ðŸš€ AUTO LOAD ON PAGE LOAD
document.addEventListener("DOMContentLoaded", loadStudents);
</script>
{% endblock %}

{% endblock %}
